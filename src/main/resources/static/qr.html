<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>TAVE QR ì¶œì„ì²´í¬</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js'></script>
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script type="text/javascript" src="./jsQR.js"></script>
    <script>
var xhr = new XMLHttpRequest();
var url = 'http://127.0.0.1:8081/adminRole/admin/getAdmin'; // ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸ URLë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤.

xhr.open('GET', url, true);
        console.log(localStorage.getItem("token"));
xhr.setRequestHeader('Authorization',localStorage.getItem("token"));
xhr.responseType = 'json';
xhr.withCredentials = true;

xhr.send();


xhr.onreadystatechange = function() {
  if (xhr.readyState === 4 && xhr.status === 200) {
    var response = xhr.response;
    // ì‘ë‹µ ë°ì´í„°(response)ë¥¼ ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    console.log(response); // ì˜ˆì‹œ: ì½˜ì†”ì— ì‘ë‹µ ë°ì´í„° ì¶œë ¥
  }
};

    </script>
    <style type="text/css">

        main {
    
            width:100%;
            height:100%;
            text-align:center;
    
        }
    
        
    
        main > div {
    
            float:left;
    
            width:1%;
    
            height:98%;
    
        }
    
        main > div:first-child {
    
            width:49%;
    
        }
    
        
    
        main > div:last-child {
    
            background-color:#D3D3D3;
    
            width:49%;
    
        }
    
    
    
        div#output {
    
            background-color:#BDBEBD;
    
            padding-left:10px;
    
            padding-right:10px;
    
            padding-top:10px;
    
            padding-bottom:10px;
    
        }
    
        
    
        div#frame {
    
            border:2px solid #005666;
    
            background-color:#FFFFFF;
    
            margin-left:10px;
    
            margin-right:10px;
    
            padding-left:8px;
    
            padding-right:8px;
    
            padding-top:8px;
    
            padding-bottom:8px;
    
        }
    
        
    
        div#outputLayer {
    
            text-align:left;
    
        }
    
        
    
        canvas {
    
            width:100%;
    
        }
    
    </style>
</head>
<body class="sb-nav-fixed">
<nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
    <!-- Navbar Brand-->
    <a class="navbar-brand ps-3" href="qr.html">TAVE</a>
    <!-- Sidebar Toggle-->
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" href="#!"><i class="fas fa-bars"></i></button>
    <!-- Navbar Search-->
    <form class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">
        <div class="input-group">
            <input class="form-control" type="text" placeholder="Search for..." aria-label="Search for..." aria-describedby="btnNavbarSearch" />
            <button class="btn btn-primary" id="btnNavbarSearch" type="button"><i class="fas fa-search"></i></button>
        </div>
    </form>
    <!-- Navbar-->
    <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                <li><hr class="dropdown-divider" /></li>
                <li><a class="dropdown-item" href="index.html">Logout</a></li>
            </ul>
        </li>
    </ul>
</nav>
<div id="layoutSidenav">
    <div id="layoutSidenav_nav">
        <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
            <div class="sb-sidenav-menu">
                <div class="nav">
                    <div class="sb-sidenav-menu-heading">TABLE</div>
                    <a class="nav-link" href="qr.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        QR-CheckIn
                    </a>
                    <a class="nav-link" href="member-tables.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        Member-Tables
                    </a>
                    <a class="nav-link" href="team-tables.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        Team-Tables
                    </a>
                    <a class="nav-link" href="member-score-note-tables.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        Member-Score-Note-Tables
                    </a>
                    <a class="nav-link" href="team-score-note-tables.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        Team-Score-Note-Tables
                    </a>
                    <a class="nav-link" href="notice-tables.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        Notice-Tables
                    </a>
                    <a class="nav-link" href="schedule-tables.html">
                        <div class="sb-nav-link-icon"><i class="fas fa-table"></i></div>
                        Schdeule-Tables
                    </a>
                </div>
            </div>
            <div class="sb-sidenav-footer">
                <div class="small">Logged in as:</div>
                TAVE ADMIN
            </div>
        </nav>
    </div>
    <div id="layoutSidenav_content">
        <main>
            <div id="test">

                <h1>QR ì½”ë“œ ë¦¬ë”</h1>
        
                <div id="output">
        
                    <div id="outputMessage">
        
                        QRì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë…¸ì¶œì‹œì¼œ ì£¼ì„¸ìš”
        
                    </div>
        
                    <div id="outputLayer" hidden>
        
                        <span id="outputData"></span>
        
                    </div>
        
                </div>
        
            </div>
        
            <div>&nbsp;</div>
        
            <div>
        
                <h1>ìŠ¤ìº”</h1>
        
                <div id="frame">
        
                    <div id="loadingMessage">
        
                        ğŸ¥ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br/>ì›¹ìº ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤
        
                    </div>
        
                    <canvas id="canvas"></canvas>
        
                </div>
        
            </div>
        
        </main>
        <footer class="py-4 bg-light mt-auto">
            <div class="container-fluid px-4">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">Copyright &copy; Your Website 2023</div>
                    <div>
                        <a href="#">Privacy Policy</a>
                        &middot;
                        <a href="#">Terms &amp; Conditions</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="js/scripts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
<script src="js/datatables-simple-demo.js"></script>
<script type="text/javascript">	

	document.addEventListener("DOMContentLoaded", function() {

		

		var video = document.createElement("video");		

		var canvasElement = document.getElementById("canvas");

		var canvas = canvasElement.getContext("2d");

		var loadingMessage = document.getElementById("loadingMessage");

		var outputContainer = document.getElementById("output");

		var outputMessage = document.getElementById("outputMessage");

		var outputData = document.getElementById("outputData");

        var scannedCodes = [];

		function drawLine(begin, end, color) {

			

			canvas.beginPath();

			canvas.moveTo(begin.x, begin.y);

			canvas.lineTo(end.x, end.y);

			canvas.lineWidth = 4;

			canvas.strokeStyle = color;

			canvas.stroke();

                }

	    

	        // ì¹´ë©”ë¼ ì‚¬ìš©ì‹œ

		navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function(stream) {

			

      		        video.srcObject = stream;

      		        video.setAttribute("playsinline", true);      // iOS ì‚¬ìš©ì‹œ ì „ì²´ í™”ë©´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì„ ì „ë‹¬

         		video.play();

      		        requestAnimationFrame(tick);

		});



		function tick() {

			

			loadingMessage.innerText = "âŒ› ìŠ¤ìº” ê¸°ëŠ¥ì„ í™œì„±í™” ì¤‘ì…ë‹ˆë‹¤."

			

			if(video.readyState === video.HAVE_ENOUGH_DATA) {

				

        		      loadingMessage.hidden = true;

        		      canvasElement.hidden = false;

        		      outputContainer.hidden = false;

        		

        		      // ì½ì–´ë“¤ì´ëŠ” ë¹„ë””ì˜¤ í™”ë©´ì˜ í¬ê¸°

        		      canvasElement.height = video.videoHeight;

        	 	      canvasElement.width = video.videoWidth;

        		

        		      canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);

        		      var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);



        		      var code = jsQR(imageData.data, imageData.width, imageData.height, {



                                    inversionAttempts : "dontInvert",

        		      });

        		

  // QR ì½”ë“œ ì¸ì‹ ì„±ê³µí•œ ê²½ìš°
  if (code) {
    // ì¸ì‹í•œ QR ì½”ë“œì˜ ì˜ì—­ì„ ê°ì‹¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í…Œë‘ë¦¬ ìƒì„±
    drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF0000");
    drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF0000");
    drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF0000");
    drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF0000");

    outputData.parentElement.hidden = false;

// QR ì½”ë“œì—ì„œ ë‚´ìš© ì¶”ì¶œ
var qrData = code.data;

// ìŠ¤ìº”ëœ QR ì½”ë“œê°€ ì´ë¯¸ ë°°ì—´ì— ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
var isDuplicate = scannedCodes.includes(qrData);

if (!isDuplicate) {
  // ìŠ¤ìº”ëœ QR ì½”ë“œ ì •ë³´ë¥¼ ë°°ì—´ì— ì¶”ê°€í•©ë‹ˆë‹¤.
  scannedCodes.push(qrData);

  // QR ì½”ë“œ ì •ë³´ë¥¼ ì¶œë ¥í•˜ëŠ” ë¶€ë¶„ ìˆ˜ì •
  var listContainer = document.getElementById("scannedList");

  if (!listContainer) {
    listContainer = document.createElement("ul");
    listContainer.setAttribute("id", "scannedList");
    output.appendChild(listContainer);
  }

  var listItem = document.createElement("li");
  listItem.textContent = qrData;
  listContainer.appendChild(listItem);
}

// QR ì½”ë“œ ìŠ¤ìº”ì´ ì™„ë£Œëœ í›„, ë‹¤ì‹œ ìŠ¤ìº” ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
setTimeout(function () {
  scanning = true;
}, 1000);
  }

        	

                              // QRì½”ë“œ ì¸ì‹ì— ì‹¤íŒ¨í•œ ê²½ìš° 

                              else {



                                    outputMessage.hidden = false;

                                    outputData.parentElement.hidden = true;

                              }

                      }

      		

      		      requestAnimationFrame(tick);

		}

	});

</script>
</body>
</html>
